load("@build_bazel_rules_nodejs//packages/cypress:index.bzl", "cypress_web_test")
load("@build_bazel_rules_nodejs//packages/typescript:index.bzl", "ts_library")

ts_library(
    name = "plugin_file",
    testonly = True,
    srcs = ["plugin.ts"],
    tags = ["cypress"],
    tsconfig = ":tsconfig.json",
    deps = [
        "@cypress_deps//:node_modules",
    ],
)

ts_library(
    name = "hello_spec",
    testonly = True,
    srcs = ["hello.spec.ts"],
    tags = ["cypress"],
    tsconfig = ":tsconfig.json",
    deps = [
        "@cypress_deps//:node_modules",
    ],
)

cypress_web_test(
    name = "test",
    srcs = [
        "world.spec.js",
        ":hello_spec",
    ],
    config_file = "cypress.json",
    cypress_npm_package = "@cypress_deps//cypress",
    data = [
        "@cypress_deps//rxjs",
    ],
    plugin_file = ":plugin_file",
    tags = ["cypress"],
)
